<!-- Enhanced Navigation CSS -->
<link rel="stylesheet" href="navigation.css">

<!-- Top Bar -->
<div class="top-bar">
    <div class="container">
        <div class="top-bar-content">
            <a href="#location-finder" class="location-finder-btn">
                <img src="https://cdn.builder.io/api/v1/image/assets%2Fd86ad443e90f49f6824eddb927a8e06f%2Fa52869d25aef4d099632c7359000a084?format=webp&width=800" alt="Location" style="width: 16px; height: 16px;">
                <span>Service Areas: Scottsdale, Paradise Valley, Phoenix Metro</span>
            </a>
            
            <div class="top-bar-right">
                <div class="search-container-topbar">
                    <div class="search-icon">
                        <img src="https://cdn.builder.io/api/v1/image/assets%2Fd86ad443e90f49f6824eddb927a8e06f%2F9994ab45dd4946ca9d44ed8521487fcb?format=webp&width=800" alt="Search" style="width: 18px; height: 18px;">
                    </div>
                    <input type="text" class="search-input-topbar" placeholder="Search services..." id="topbar-search"/>
                    <div class="search-shortcut">⌘K</div>
                </div>
                <div class="top-bar-icons">
                    <a href="tel:+1-602-688-9825" class="icon-btn" aria-label="Call us">
                        <img src="https://cdn.builder.io/api/v1/image/assets%2Fd86ad443e90f49f6824eddb927a8e06f%2Fbae85ea7a53340689fac18198ef90b88?format=webp&width=800" alt="Call" style="width: 18px; height: 18px;">
                    </a>
                    <a href="pages/book-appointment.html" class="icon-btn" aria-label="Book appointment">
                        <img src="https://cdn.builder.io/api/v1/image/assets%2Fd86ad443e90f49f6824eddb927a8e06f%2F0d2c03ac1a704d62ba6498cbfc1c0a75?format=webp&width=800" alt="Calendar" style="width: 18px; height: 18px;">
                    </a>
                    <a href="pages/checkout.html" class="icon-btn" aria-label="Shopping cart">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 18c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12L8.1 13h7.45c.75 0 1.41-.41 1.75-1.03L21.7 4H5.21l-.94-2H1zm16 16c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/>
                        </svg>
                        <span class="cart-count">0</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Header -->
<header class="header" id="header">
    <div class="container">
        <nav class="nav">
            <a href="/" class="logo">
                <img src="https://cdn.builder.io/api/v1/image/assets%2F1268a8aa36364ef795a07a801a639f41%2Ff74b8d31183c4e73ad423862ef65b827?format=webp&width=800" alt="Stay Dripped IV & Wellness Co. Logo" loading="eager">
            </a>
            
            <ul class="nav-links">
                <li class="nav-expandable">
                    <button class="nav-link service-category-btn" data-category="iv-therapy">
                        IV Therapy
                        <svg class="expand-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                    </button>
                    <div class="nav-expansion" data-category="iv-therapy">
                        <a href="pages/book-ivtherapy.html" class="expansion-link">IV Therapy Services</a>
                        <a href="pages/vitamin-injections.html" class="expansion-link">Vitamin Injections</a>
                    </div>
                </li>
                <li class="nav-expandable">
                    <button class="nav-link service-category-btn" data-category="advanced-treatments">
                        Advanced Treatments
                        <svg class="expand-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                    </button>
                    <div class="nav-expansion" data-category="advanced-treatments">
                        <a href="pages/nad-peptides.html" class="expansion-link">NAD+ & Peptides</a>
                        <a href="pages/weight-management.html" class="expansion-link">Weight Management</a>
                        <a href="pages/sexual-wellness.html" class="expansion-link">Sexual Wellness</a>
                    </div>
                </li>
                <li><a href="pages/telehealth-services.html" class="nav-link">Telehealth</a></li>
                <li><a href="pages/supplements-catalog.html" class="nav-link">Supplements & Tests</a></li>
                <li><a href="pages/unified-booking.html" class="nav-link">Booking</a></li>
                <li class="nav-expandable">
                    <button class="nav-link service-category-btn" data-category="patient-resources">
                        Patient Resources
                        <svg class="expand-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                    </button>
                    <div class="nav-expansion" data-category="patient-resources">
                        <a href="pages/first-time-patients.html" class="expansion-link">New Patients</a>
                        <a href="pages/membership.html" class="expansion-link">Membership</a>
                        <a href="pages/gift-cards.html" class="expansion-link">Gift Cards</a>
                        <a href="pages/compliance.html" class="expansion-link">Compliance</a>
                    </div>
                </li>
                <li class="nav-expandable">
                    <button class="nav-link service-category-btn" data-category="events-corporate">
                        Events & Corporate
                        <svg class="expand-icon" width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                    </button>
                    <div class="nav-expansion" data-category="events-corporate">
                        <a href="pages/event-corporate-inquiry.html" class="expansion-link">Corporate Services</a>
                        <a href="pages/event-corporate-inquiry.html" class="expansion-link">Special Events</a>
                    </div>
                </li>
                <li><a href="#team" class="nav-link">Our Team</a></li>
                <li><a href="#contact" class="nav-link">Contact</a></li>
            </ul>
            
            <div class="nav-actions">
                <a href="tel:+1-602-688-9825" class="btn btn-secondary">Call Now</a>

                <!-- Good Faith Exam Widget -->
                <div id="main-qualiphy-widget-nav" style="display: inline-block;">
                    <div
                        id="loadFormButtonNav"
                        style="width: 140px;height: 42px;cursor: pointer;background-color: #cfc9ff;color: #0a005b;border: none;border-radius: 6px;font-weight: 600;display: flex;justify-content: center;align-items: center;font-size: 14px;transition: all 0.3s ease;margin-right: 12px;"
                        onmouseover="this.style.backgroundColor='#8058fa'; this.style.color='white'"
                        onmouseout="this.style.backgroundColor='#CFC9FF'; this.style.color='#0A005B'"
                        onclick="showDisclosureModal()"
                    >
                        Exam Required
                    </div>
                </div>

                <a href="pages/unified-booking.html" class="btn btn-book-now">BOOK NOW</a>
            </div>

            <button class="mobile-menu-toggle" aria-label="Toggle mobile menu" onclick="toggleMobileNav()">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>

        <!-- Mobile Menu Dropdown -->
        <div class="mobile-menu" id="mobile-menu">
            <div class="mobile-menu-content">
                <div class="mobile-menu-header">
                    <a href="/" class="mobile-menu-logo">
                        <img src="https://cdn.builder.io/api/v1/image/assets%2F1268a8aa36364ef795a07a801a639f41%2Ff74b8d31183c4e73ad423862ef65b827?format=webp&width=800" alt="Stay Dripped IV & Wellness Co. Logo">
                    </a>
                    <button class="mobile-menu-close" aria-label="Close mobile menu">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>

                <nav class="mobile-menu-nav">
                    <div class="mobile-menu-section">
                        <button class="mobile-menu-item mobile-dropdown-toggle" data-target="services-mobile">
                            <span>Services</span>
                            <svg class="mobile-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7 10l5 5 5-5z"/>
                            </svg>
                        </button>
                        <div class="mobile-dropdown-content" id="services-mobile">
                            <div class="mobile-dropdown-section">
                                <h4>IV Therapy</h4>
                                <a href="pages/book-ivtherapy.html">IV Therapy Services</a>
                                <a href="pages/vitamin-injections.html">Vitamin Injections</a>
                            </div>
                            <div class="mobile-dropdown-section">
                                <h4>Advanced Treatments</h4>
                                <a href="pages/nad-peptides.html">NAD+ & Peptides</a>
                                <a href="pages/weight-management.html">Weight Management</a>
                                <a href="pages/sexual-wellness.html">Sexual Wellness</a>
                            </div>
                        </div>
                    </div>

                    <a href="pages/telehealth-services.html" class="mobile-menu-item">Telehealth</a>
                    <a href="pages/supplements-catalog.html" class="mobile-menu-item">Supplements & Tests</a>
                    <a href="pages/unified-booking.html" class="mobile-menu-item">Booking</a>
                    
                    <div class="mobile-menu-section">
                        <button class="mobile-menu-item mobile-dropdown-toggle" data-target="patient-resources-mobile">
                            <span>Patient Resources</span>
                            <svg class="mobile-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7 10l5 5 5-5z"/>
                            </svg>
                        </button>
                        <div class="mobile-dropdown-content" id="patient-resources-mobile">
                            <a href="pages/first-time-patients.html">New Patients</a>
                            <a href="pages/membership.html">Membership</a>
                            <a href="pages/gift-cards.html">Gift Cards</a>
                            <a href="pages/compliance.html">Compliance</a>
                        </div>
                    </div>

                    <div class="mobile-menu-section">
                        <button class="mobile-menu-item mobile-dropdown-toggle" data-target="events-corporate-mobile">
                            <span>Events & Corporate</span>
                            <svg class="mobile-dropdown-arrow" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M7 10l5 5 5-5z"/>
                            </svg>
                        </button>
                        <div class="mobile-dropdown-content" id="events-corporate-mobile">
                            <a href="pages/event-corporate-inquiry.html">Corporate Services</a>
                            <a href="pages/event-corporate-inquiry.html">Special Events</a>
                        </div>
                    </div>

                    <a href="#team" class="mobile-menu-item">Our Team</a>
                    <a href="#contact" class="mobile-menu-item">Contact</a>
                </nav>

                <div class="mobile-menu-actions">
                    <a href="tel:+1-602-688-9825" class="mobile-btn mobile-btn-secondary">
                        <img src="https://cdn.builder.io/api/v1/image/assets%2F337c720945064b44af05129952e6433b%2F87c674f2834845aa9d4108c24cca538a?format=webp&width=800" alt="Phone" style="width: 18px; height: 18px;">
                        Call Now
                    </a>
                    <a href="pages/book-appointment.html" class="mobile-btn mobile-btn-primary">
                        <img src="https://cdn.builder.io/api/v1/image/assets%2F337c720945064b44af05129952e6433b%2Fa759c61b68aa4add9c65c77c443410ab?format=webp&width=800" alt="Book Appointment" style="width: 18px; height: 18px;">
                        Book Appointment
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- BULLETPROOF UNIVERSAL NAVIGATION JAVASCRIPT -->
<script>
(function() {
    'use strict';
    
    console.log('🚀 UNIVERSAL Navigation JS starting...');
    
    // Universal navigation setup that works on ANY page
    function universalNavigationSetup() {
        console.log('⚡ Setting up universal navigation...');
        
        let setupAttempts = 0;
        const maxAttempts = 10;
        
        function setupNavigation() {
            setupAttempts++;
            console.log(`📋 Navigation setup attempt ${setupAttempts}/${maxAttempts}`);
            
            // Get all navigation elements
            const serviceButtons = document.querySelectorAll('.service-category-btn');
            const expansions = document.querySelectorAll('.nav-expansion');
            const mobileToggle = document.querySelector('.mobile-menu-toggle');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileClose = document.querySelector('.mobile-menu-close');
            const mobileDropdowns = document.querySelectorAll('.mobile-dropdown-toggle');
            
            console.log(`🔍 Found: ${serviceButtons.length} buttons, ${expansions.length} expansions, mobile: ${!!mobileToggle}`);
            
            if (serviceButtons.length === 0 && setupAttempts < maxAttempts) {
                console.log(`⏰ No buttons found, retrying in 200ms...`);
                setTimeout(setupNavigation, 200);
                return;
            }
            
            // 1. DESKTOP DROPDOWN FUNCTIONALITY
            serviceButtons.forEach(function(button, index) {
                console.log(`🔘 Setting up button ${index + 1}: ${button.getAttribute('data-category')}`);
                
                // Remove any existing listeners by cloning
                const newButton = button.cloneNode(true);
                button.parentNode.replaceChild(newButton, button);
                
                newButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const category = this.getAttribute('data-category');
                    const expansion = document.querySelector('.nav-expansion[data-category="' + category + '"]');
                    const isExpanded = this.classList.contains('expanded');
                    
                    console.log(`🎯 Clicked: ${category}, expanded: ${isExpanded}`);
                    
                    // Close all expansions first
                    document.querySelectorAll('.service-category-btn').forEach(function(btn) {
                        btn.classList.remove('expanded');
                    });
                    document.querySelectorAll('.nav-expansion').forEach(function(exp) {
                        exp.classList.remove('expanded');
                    });
                    
                    // Open current if not expanded
                    if (!isExpanded && expansion) {
                        this.classList.add('expanded');
                        expansion.classList.add('expanded');
                        console.log(`✅ Opened: ${category}`);
                    }
                });
            });
            
            // 2. MOBILE MENU FUNCTIONALITY
            window.toggleMobileNav = function() {
                console.log('📱 Toggling mobile menu...');
                
                if (mobileMenu) {
                    const isActive = mobileMenu.classList.contains('active');
                    
                    if (isActive) {
                        mobileMenu.classList.remove('active');
                        mobileToggle?.classList.remove('active');
                        document.body.style.overflow = '';
                        console.log('📱 Mobile menu closed');
                    } else {
                        mobileMenu.classList.add('active');
                        mobileToggle?.classList.add('active');
                        document.body.style.overflow = 'hidden';
                        console.log('📱 Mobile menu opened');
                    }
                }
            };
            
            // Mobile close button
            if (mobileClose) {
                mobileClose.addEventListener('click', function() {
                    console.log('❌ Mobile menu close clicked');
                    mobileMenu?.classList.remove('active');
                    mobileToggle?.classList.remove('active');
                    document.body.style.overflow = '';
                });
            }
            
            // 3. MOBILE DROPDOWN FUNCTIONALITY
            mobileDropdowns.forEach(function(toggle) {
                toggle.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    const dropdown = document.getElementById(targetId);
                    
                    if (dropdown) {
                        const isActive = this.classList.contains('active');
                        
                        // Close all other dropdowns
                        mobileDropdowns.forEach(function(otherToggle) {
                            if (otherToggle !== toggle) {
                                otherToggle.classList.remove('active');
                                const otherId = otherToggle.getAttribute('data-target');
                                const otherDropdown = document.getElementById(otherId);
                                if (otherDropdown) {
                                    otherDropdown.classList.remove('active');
                                }
                            }
                        });
                        
                        // Toggle current
                        if (isActive) {
                            this.classList.remove('active');
                            dropdown.classList.remove('active');
                        } else {
                            this.classList.add('active');
                            dropdown.classList.add('active');
                        }
                        
                        console.log(`📂 Mobile dropdown ${targetId}: ${!isActive ? 'opened' : 'closed'}`);
                    }
                });
            });
            
            // 4. CLOSE DROPDOWNS ON OUTSIDE CLICK
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.nav-expandable')) {
                    document.querySelectorAll('.service-category-btn').forEach(function(btn) {
                        btn.classList.remove('expanded');
                    });
                    document.querySelectorAll('.nav-expansion').forEach(function(exp) {
                        exp.classList.remove('expanded');
                    });
                }
            });
            
            // 5. HEADER SCROLL EFFECT
            const header = document.getElementById('header');
            if (header) {
                window.addEventListener('scroll', function() {
                    if (window.scrollY > 50) {
                        header.classList.add('scrolled');
                    } else {
                        header.classList.remove('scrolled');
                    }
                });
            }
            
            // 6. SEARCH FUNCTIONALITY
            const searchInput = document.getElementById('topbar-search');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        const query = e.target.value.trim();
                        if (query) {
                            console.log('🔍 Search:', query);
                        }
                    }
                });
                
                // Keyboard shortcut
                document.addEventListener('keydown', function(e) {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        searchInput.focus();
                    }
                });
            }
            
            // 7. ESCAPE KEY TO CLOSE MOBILE MENU
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && mobileMenu && mobileMenu.classList.contains('active')) {
                    window.toggleMobileNav();
                }
            });
            
            console.log('🎉 Universal navigation setup COMPLETED!');
        }
        
        // Start setup immediately
        setupNavigation();
    }
    
    // Initialize universally - multiple triggers to ensure it works
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', universalNavigationSetup);
    } else {
        universalNavigationSetup();
    }
    
    // Also setup when navigation is loaded
    window.addEventListener('navigationLoaded', function() {
        console.log('🔄 Navigation loaded event received');
        setTimeout(universalNavigationSetup, 50);
    });
    
    // Mutation observer for dynamic content
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
                const hasNavigationContent = Array.from(mutation.addedNodes).some(function(node) {
                    return node.nodeType === Node.ELEMENT_NODE && 
                           (node.querySelector && node.querySelector('.service-category-btn') || 
                            node.classList && node.classList.contains('service-category-btn'));
                });
                
                if (hasNavigationContent) {
                    console.log('🔍 Navigation content detected, setting up...');
                    setTimeout(universalNavigationSetup, 50);
                }
            }
        });
    });
    
    // Start observing when ready
    if (document.body) {
        observer.observe(document.body, { childList: true, subtree: true });
    } else {
        document.addEventListener('DOMContentLoaded', function() {
            observer.observe(document.body, { childList: true, subtree: true });
        });
    }
    
    // Global debug function
    window.debugNavigation = function() {
        console.log('=== 🐛 NAVIGATION DEBUG ===');
        const buttons = document.querySelectorAll('.service-category-btn');
        const expansions = document.querySelectorAll('.nav-expansion');
        const mobile = document.querySelector('.mobile-menu-toggle');
        
        console.log('🔘 Buttons:', buttons.length);
        console.log('📂 Expansions:', expansions.length);
        console.log('📱 Mobile toggle:', !!mobile);
        
        buttons.forEach(function(btn, i) {
            console.log(`Button ${i + 1}:`, {
                category: btn.getAttribute('data-category'),
                text: btn.textContent.trim(),
                hasListeners: !!btn.onclick
            });
        });
        
        return {
            buttons: buttons.length,
            expansions: expansions.length,
            mobile: !!mobile,
            working: buttons.length > 0 && expansions.length > 0
        };
    };
    
    console.log('🚀 Universal Navigation JS loaded and ready!');
})();
</script>
